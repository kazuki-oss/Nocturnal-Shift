{% extends 'admin/layout.html.twig' %}

{% block title %}シフト自動生成{% endblock %}

{% block admin_content %}
<div class="page-header">
    <h2 class="page-title">シフト自動生成</h2>
    <div class="header-actions">
        <a href="{{ path('admin_shift_template_new') }}" class="btn btn-primary">
            <i class="mdi mdi-plus"></i> テンプレート作成
        </a>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card mb-4">
            <div class="card-header">
                <h3 class="card-title">シフトテンプレート一覧</h3>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>名前</th>
                                <th>時間</th>
                                <th>適用曜日</th>
                                <th>必要人数</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for template in templates %}
                                <tr>
                                    <td>{{ template.name }}</td>
                                    <td>{{ template.startTime|date('H:i') }} - {{ template.endTime|date('H:i') }}</td>
                                    <td>
                                        {% set days = ['日', '月', '火', '水', '木', '金', '土'] %}
                                        {% for day in template.applicableDays %}
                                            <span class="badge badge-secondary">{{ days[day] }}</span>
                                        {% endfor %}
                                    </td>
                                    <td>{{ template.requiredStaffCount }}名</td>
                                    <td>
                                        <a href="{{ path('admin_shift_template_edit', {id: template.id}) }}" class="btn btn-sm btn-outline-primary">
                                            <i class="mdi mdi-pencil"></i>
                                        </a>
                                        <form method="post" action="{{ path('admin_shift_template_delete', {id: template.id}) }}" style="display: inline-block;" onsubmit="return confirm('削除しますか？');">
                                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ template.id) }}">
                                            <button class="btn btn-sm btn-outline-danger">
                                                <i class="mdi mdi-delete"></i>
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            {% else %}
                                <tr>
                                    <td colspan="5" class="text-center">テンプレートがありません</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">自動生成実行</h3>
            </div>
            <div class="card-body">
                <form method="post" action="{{ path('admin_shift_generate') }}">
                    <div class="form-group mb-3">
                        <label>期間開始</label>
                        <input type="date" name="start_date" class="form-control" value="{{ 'now'|date('Y-m-d') }}" required>
                    </div>
                    <div class="form-group mb-3">
                        <label>期間終了</label>
                        <input type="date" name="end_date" class="form-control" value="{{ 'now'|date_modify('+1 month')|date('Y-m-d') }}" required>
                    </div>
                    <div class="alert alert-info">
                        <small>
                            <i class="mdi mdi-information"></i>
                            登録されたテンプレートに基づいて、空いている従業員をランダムに割り当ててシフトを生成します。
                        </small>
                    </div>
                    <button type="submit" class="btn btn-success w-100" onclick="return confirm('シフトを生成しますか？既存のシフトは維持されます。');">
                        <i class="mdi mdi-robot"></i> 生成実行
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<style>
.badge {
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 0.8em;
    color: white;
    margin-right: 2px;
}
.badge-secondary { background-color: #6c757d; }
.w-100 { width: 100%; }
</style>
{% endblock %}
